<div class="container-fluid">
  <div class="nav col-md-12 action-form">
    <div class="nav flex-column nav-pills col-md-5 col-lg-4 col-xl-3" id="v-pills-tab" role="tablist" aria-orientation="vertical">
      <% @types.each do |type| %>
        <a class="nav-link action-btn-active" id="v-pills-home-tab" data-toggle="pill"
          href="#v-pills-home" role="tab" aria-controls="v-pills-home" aria-selected="false"><%= type %></a>
      <% end %>
    </div>
    <div class="tab-content col-md-6 action-form-content">
      <div class="tab-pane fade show active" id="tab-container" role="tabpanel" aria-labelledby="v-pills-home-tab">
        <div class="report-form-body" id="hide-when-type-selected">
          <div class="default-tab-text">Form will appear here</div>
        </div>
        <div class="report-form-body" id="hide-until-type-selected">
          <%= yield %>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
(() => {
  const navLinks = document.getElementsByClassName('nav-link');
  const type = '<%= params[:training_type] || params[:type] || '' %>';

  const startFormWithType = (navLink, shouldClearForm) => {
    setFormType(navLink.textContent);
    shouldClearForm && clearFormFields();
    unselectAllNavLinks();
    selectNavLink(navLink);
    showForm();
  };

  const setFormType = type => {
    document.getElementById('training-type-input').value = type;
    document.getElementById('form-title').innerHTML = type;
  };

  const clearFormFields = () => {
    for (const clearable of document.getElementsByClassName('clearable')) {
      clearable.value = "";
    }
  };

  const unselectAllNavLinks = () => {
    for(const navLinkToModify of navLinks) {
      navLinkToModify.classList.remove('active');
      navLinkToModify.setAttribute('aria-selected', false);
    }
  };

  const selectNavLink = navLink => {
    navLink.classList.add('active');
    navLink.setAttribute('aria-selected', true);
  };

  const showForm = () => {
    document.getElementById('hide-until-type-selected').style.display = 'block';
    document.getElementById('tab-container').style.display = 'block';
    document.getElementById('hide-when-type-selected').style.display = 'none';
  };

  for(const navLink of navLinks) {
    navLink.addEventListener('click', e => {
      startFormWithType(navLink, true);
    });

    if(navLink.textContent === type) {
      startFormWithType(navLink, false);
    }
  }
})();
</script>