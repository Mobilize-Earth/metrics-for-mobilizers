image: "ruby:2.7"

services:
  - mysql:latest

variables:
  MYSQL_DATABASE: climate_movement_reporting_tool_test
  MYSQL_ROOT_PASSWORD: testdb

before_script:
  - apt-get update -qq && apt-get install -y qq build-essentials nodejs libmysql
  - ruby -v
  - which ruby
  - gem install bundler --no-document
  - bundle install

stages:
  - unit_test
  - integration_test

unit_test:
  script:
    - bundle exec rspec spec/unit

integration_test:
  script:
    - bundle exec rspec spec/features
